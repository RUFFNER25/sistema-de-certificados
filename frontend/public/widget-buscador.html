<!-- WIDGET BUSCADOR DE CERTIFICADOS - JC ECOGUARDIANS -->
<div id="cert-widget-container">
  <style>
    :root {
      --primary: #08a696;
      --accent-green: #8cbf3f;
      --accent-green-hover: #7da836;
      --text-main: #1e293b;
      --text-secondary: #64748b;
      --border-color: #e2e8f0;
    }

    #cert-widget-container {
      font-family: 'Inter', system-ui, -apple-system, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      color: var(--text-main);
    }

    .widget-search-section {
      background: var(--primary);
      padding: 40px 20px;
      border-radius: 12px;
      text-align: center;
      margin-bottom: 30px;
      color: white;
    }

    .widget-title {
      font-size: 28px;
      font-weight: 800;
      margin-bottom: 25px;
    }

    .widget-search-form {
      background: white;
      border-radius: 8px;
      padding: 10px;
      display: flex;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      flex-wrap: wrap;
    }

    .widget-select, .widget-input {
      padding: 12px;
      border: 1px solid var(--border-color);
      border-radius: 6px;
      font-size: 14px;
      color: var(--text-main);
    }

    .widget-select { flex: 1; min-width: 150px; cursor: pointer; }
    .widget-input { flex: 2; min-width: 200px; }

    .widget-btn {
      padding: 12px 24px;
      background: var(--accent-green);
      color: white;
      border: none;
      border-radius: 6px;
      font-weight: 700;
      cursor: pointer;
      transition: 0.2s;
    }

    .widget-btn:hover { background: var(--accent-green-hover); }

    /* Título único de resultados */
    .widget-results-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      color: var(--text-main);
    }

    /* Lista de tarjetas compactas */
    .widget-results-list { display: flex; flex-direction: column; gap: 20px; }

    .result-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 10px;
      padding: 20px 24px;
      max-width: 520px;
      transition: box-shadow 0.2s;
    }
    .result-card:hover { box-shadow: 0 2px 8px rgba(0,0,0,0.06); }

    .result-card-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    .result-card-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: #f1f5f9;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #64748b;
      flex-shrink: 0;
    }
    .result-card-avatar svg { width: 20px; height: 20px; }
    .result-card-name { font-size: 16px; font-weight: 600; color: var(--text-main); }

    .result-card-divider {
      border: none;
      border-top: 1px solid #e2e8f0;
      margin: 14px 0 16px;
    }

    .result-card-title-block { margin-bottom: 14px; }
    .result-card-cert-title { font-size: 16px; font-weight: 700; color: var(--text-main); margin: 0 0 4px; }
    .result-card-type { font-size: 14px; color: var(--text-secondary); }

    .result-card-meta {
      list-style: none;
      margin: 0 0 18px;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .result-card-meta-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: var(--text-main);
    }
    .result-card-meta-icon {
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--primary);
      flex-shrink: 0;
    }
    .result-card-meta-icon svg { width: 14px; height: 14px; }

    .result-card-download {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border: 1px solid #cbd5e1;
      border-radius: 999px;
      background: white;
      color: var(--text-main);
      font-size: 14px;
      font-weight: 600;
      text-decoration: none;
      transition: background 0.2s, border-color 0.2s;
    }
    .result-card-download:hover {
      background: #f8fafc;
      border-color: var(--primary);
      color: var(--primary);
    }
    .result-card-download svg { width: 18px; height: 18px; }

    @media (max-width: 600px) { .widget-search-form { flex-direction: column; } .result-card { padding: 16px; } }
  </style>

  <div class="widget-search-section">
    <h2 class="widget-title">Validar certificados</h2>
    <form class="widget-search-form" id="certForm">
      <select id="certType" class="widget-select">
        <option value="dni">DNI</option>
        <option value="nombre">Nombres y apellidos</option>
        <option value="codigo">Código</option>
      </select>
      <input type="text" id="certInput" class="widget-input" placeholder="Ej: 70552292">
      <button type="submit" id="certBtn" class="widget-btn">BUSCAR</button>
    </form>
    <div id="certMsg" style="margin-top: 15px; font-size: 13px;"></div>
  </div>

  <div id="certResults"></div>

  <script>
    (function() {
      const API = 'https://admincertificados.jcecoguardians.com'; // Producción
      // const API = 'http://localhost:4000'; // Desarrollo local
      const form = document.getElementById('certForm');
      const results = document.getElementById('certResults');
      const msg = document.getElementById('certMsg');

      form.onsubmit = async (e) => {
        e.preventDefault();
        const query = document.getElementById('certInput').value.trim();
        if(!query) return alert('Ingrese un valor');

        document.getElementById('certBtn').innerText = 'BUSCANDO...';
        results.innerHTML = '';
        msg.innerText = '';

        try {
          const r = await fetch(`${API}/api/certificados?q=${encodeURIComponent(query)}`);
          const data = await r.json();
          
          if(data.length === 0) {
            msg.innerText = 'No se encontraron resultados.';
          } else {
            const cal = (d) => d ? new Date(d).toLocaleDateString('es-PE') : '-';
            const iconCal = '<rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/><line x1="16" y1="2" x2="16" y2="6" stroke="currentColor" stroke-width="2"/><line x1="8" y1="2" x2="8" y2="6" stroke="currentColor" stroke-width="2"/><line x1="3" y1="10" x2="21" y2="10" stroke="currentColor" stroke-width="2"/>';
            const metaRow = (svg, text) => `<li class="result-card-meta-item"><span class="result-card-meta-icon" aria-hidden><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">${svg}</svg></span><span>${text}</span></li>`;

            results.innerHTML = '<h2 class="widget-results-title">Los resultados para tu búsqueda:</h2><div class="widget-results-list">' + data.map(c => `
              <article class="result-card">
                <div class="result-card-header">
                  <span class="result-card-avatar" aria-hidden><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span>
                  <span class="result-card-name">${escapeHtml(c.nombre)}</span>
                </div>
                <hr class="result-card-divider">
                <div class="result-card-title-block">
                  <h3 class="result-card-cert-title">${escapeHtml(c.certificado_nombre || 'Certificado')}</h3>
                  ${c.tipo ? `<span class="result-card-type">${escapeHtml(c.tipo)}</span>` : ''}
                </div>
                <ul class="result-card-meta">
                  ${metaRow('<rect x="3" y="4" width="18" height="18" rx="2" stroke="currentColor" stroke-width="2"/><path d="M16 2v4M8 2v4M3 10h18"/>', 'DNI: ' + escapeHtml(c.dni))}
                  ${c.codigo ? metaRow('<path d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4" stroke="currentColor" stroke-width="2"/>', 'Código: ' + escapeHtml(c.codigo)) : ''}
                  ${c.duracion ? metaRow('<circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2"/><polyline points="12 6 12 12 16 14" stroke="currentColor" stroke-width="2"/>', 'Duración: ' + escapeHtml(c.duracion)) : ''}
                  ${c.fecha_emision ? metaRow(iconCal, 'Fecha de emisión: ' + cal(c.fecha_emision)) : ''}
                  ${metaRow(iconCal, 'Fecha de caducidad: ' + cal(c.fecha_caducidad))}
                </ul>
                <a href="${API}${c.url}" target="_blank" rel="noopener" class="result-card-download">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                  Descargar
                </a>
              </article>
            `).join('') + '</div>';
          }
        } catch(e) { 
          msg.innerText = 'Error de conexión con el servidor.';
        } finally {
          document.getElementById('certBtn').innerText = 'BUSCAR';
        }
      };

      function escapeHtml(s) {
        if (!s) return '';
        const div = document.createElement('div');
        div.textContent = s;
        return div.innerHTML;
      }
    })();
  </script>
</div>